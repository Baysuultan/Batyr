{% extends 'base.html' %}

{% block title %}{{ course.title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            {% if course.thumbnail %}
                <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" style="width: 100%; height: 400px; object-fit: cover;">
            {% else %}
                <div style="width: 100%; height: 400px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-image" style="font-size: 80px; opacity: 0.3;"></i>
                </div>
            {% endif %}
        </div>
        
        <h1 class="fw-bold mb-3">{{ course.title }}</h1>
        
        <div class="mb-4">
            <span class="badge bg-info">{{ course.category.name }}</span>
            <span class="badge bg-secondary">{{ course.get_level_display }}</span>
            <span class="badge bg-warning">{{ course.students_count }} студентов</span>
        </div>
        
        <h4 class="fw-bold mt-4">Описание</h4>
        <p>{{ course.description }}</p>
        
        <h4 class="fw-bold mt-4">Результаты обучения</h4>
        <p>{{ course.learning_outcomes }}</p>
    </div>
    
    <div class="col-lg-4">
        <div class="card shadow-sm sticky-top">
            <div class="card-body">
                <h3 class="text-primary fw-bold mb-3">{{ course.price }} ₸</h3>
                
                {% if is_enrolled %}
                    <div class="alert alert-success">Вы записаны на этот курс</div>
                    <a href="{% url 'courses:lessons' course.slug %}" class="btn btn-primary w-100 mb-2">Перейти к урокам</a>
                    <a href="{% url 'courses:unenroll' course.slug %}" class="btn btn-outline-danger w-100">Отписаться</a>
                {% else %}
                    {% if user.is_authenticated %}
                        <a href="{% url 'courses:enroll' course.slug %}" class="btn btn-primary w-100 mb-2">Записаться на курс</a>
                    {% else %}
                        <a href="{% url 'accounts:login' %}" class="btn btn-primary w-100 mb-2">Войти чтобы записаться</a>
                    {% endif %}
                {% endif %}
                
                <div class="mt-4 pt-3 border-top">
                    <p class="fw-bold">Информация о курсе:</p>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-hourglass-end"></i> {{ course.duration_hours }} часов</li>
                        <li class="mb-2"><i class="fas fa-book"></i> {{ course.total_lessons }} уроков</li>
                        <li class="mb-2"><i class="fas fa-user-tie"></i> {{ course.instructor.get_full_name|default:course.instructor.username }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reviews -->
<div class="my-5">
    <h4 class="fw-bold">Отзывы ({{ reviews.count }})</h4>
    {% if reviews %}
        {% for review in reviews %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="fw-bold">{{ review.author.username }}</h6>
                            <div class="rating">
                                {% for i in "12345" %}
                                    <i class="fas fa-star{% if i|add:0 > review.rating %}far{% endif %}"></i>
                                {% endfor %}
                            </div>
                        </div>
                        <small class="text-muted">{{ review.created_at|date:"d.m.Y" }}</small>
                    </div>
                    <p class="mt-2">{{ review.comment }}</p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Нет отзывов</p>
    {% endif %}
</div>
{% endblock %}